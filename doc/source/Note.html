<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">

<span id='C-Note'>/**
</span> * Basic Note class with some playable attributes (future)
 * @class C.Note
 * @extends C.Class
 */
C.Note = C.Class.extend({
    options: {
	note: &quot;-&quot;,
	
	// Playable attributes
	duration: 1,		// time duration (sec?)
	style: &quot;&quot;,		// bend &quot;b&quot;, vibrato &quot;~&quot;
	styleAttr: &quot;&quot;,		// Style attribure: 1, 1/2, etc for bends,
	octaveOffset:false,	// Used for 9ths +
	playPos: -1	 	// Position on an instrument (comparison between instr cannot be done)
    },
    
    
    initialize: function (options) {
	C.setOptions(this, options);
    },
    
    toString: function(){
	return this.options.note;
    },
    
    setNote: function(note){
	this.options.note = note;
    },
    
<span id='C-Note-method-offset'>    /**
</span>     * Offest by off. Off is in half-tones, if step is given 
     * then it will off*step ie: step=2 (by tone)
     * @chainable
     */
    offset: function(off, step){
	if (this.options.note==&quot;-&quot;) return this;
			
	var idx = C.Note.noteIndex(this.options.note);
	if (step!==undefined) off*=step;
	
	// Offset playPos by the FULL amount
	if (this.options.playPos!=-1)
	    this.options.playPos+=off;
	
	var newIdx = (idx+off)%C.NOTES.length;
	this.options.note = C.NOTES[newIdx];
	
	return this;
    },
    
    offsetNotes: function(off){
	if (off==0) return;
	var idx2 = C.NOTES2.indexOf(this.options.note);
	idx2 = (off + idx2)%C.NOTES2.length;
	
	var newIdx = C.NOTES.indexOf(C.NOTES2[idx2]);
	this.options.note = C.NOTES[newIdx];
    },
    
<span id='C-Note-method-offsetStr'>    /**
</span>     * Offest based on formula string ie: b3 or 2#
     * @chainable
     */
    offsetStr: function(f){
	
	var off = 0;
	if (f[0]==&quot;b&quot;) {
	    f = parseInt(f[1]);
	    off=-1;
	}
	else if (f[0]==&quot;#&quot;){
	    f = parseInt(f[1]);
	    off=1;
	}
	
	this.offsetNotes(f-1);
	
	return this.offset(off);
	
    },
    
    getIdx: function(useOffset) {
	var off = C.Note.noteIndex(this.options.note);
	if (useOffset &amp;&amp; this.options.octaveOffset) off+=C.NOTES.length;
	return off;
    }

});

<span id='C-Note-static-method-noteIndex'>/**
</span> * @static
 */
C.Note.noteIndex = function(note){
    return C.NOTES.indexOf(note);
};

<span id='C-Note-static-method-indexNote'>/**
</span> * @static
 */
C.Note.indexNote = function(idx){
    return C.NOTES[idx];
};

<span id='C-Note-static-method-byIdx'>/**
</span> * @static
 */
C.Note.byIdx = function(idx){
    return new C.Note({note: C.NOTES[idx]});
};</pre>
</body>
</html>
