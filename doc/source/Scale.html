<!DOCTYPE html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <title>The source code</title>
  <link href="../resources/prettify/prettify.css" type="text/css" rel="stylesheet" />
  <script type="text/javascript" src="../resources/prettify/prettify.js"></script>
  <style type="text/css">
    .highlight { display: block; background-color: #ddd; }
  </style>
  <script type="text/javascript">
    function highlight() {
      document.getElementById(location.hash.replace(/#/, "")).className = "highlight";
    }
  </script>
</head>
<body onload="prettyPrint(); highlight();">
  <pre class="prettyprint lang-js">
<span id='C-Scale'>/**
</span> * Basic Scale class
 * 
 * @class C.Scale
 * @extends C.Class
 */
C.Scale = C.Class.extend({
    options: {
	root: &quot;C&quot;,
	type: &quot;Major&quot;
    },
    
<span id='C-Scale-method-initialize'>    /**
</span>     * Base init function. It will load the scale 
     * distances and cache it 
     * 
     * @param {Object} options
     */
    initialize: function (options) {
	C.setOptions(this, options);
	// Cache distances
	this.dist = C.Scale.TYPES[this.options.type];
    },
    
<span id='C-Scale-method-offset'>    /**
</span>     * Get a note offset by f on the current scale and
     * from the current root note. 'f' is in the formula
     * format (ie. &quot;1&quot; or &quot;b5&quot;)
     * 
     * @param {String} f
     * @return {C.Note}
     */
    offset: function(f){
	// Check for optional 1st
	if (f[0]==&quot;(&quot;) {
	    f = f.substring(1,f.length-1);
	}
	
	var off = 0;
	if (f[0]==&quot;b&quot;) {
	    f = parseInt(f.substring(1));
	    off=-1;
	}
	else if (f[0]==&quot;#&quot;){
	    f = parseInt(f.substring(1));
	    off=1;
	}
	
	
	// Loop offset! 9ths/11ths
	var oo = 0;
	if (f&gt;this.dist.length) {
	    f=f%this.dist.length;
	    oo=1; // FIXME:!Not exactly, assuming only 1 octave offset
	}
	
	
	for (var i=0; (i&lt;this.dist.length &amp;&amp; i&lt;f-1); i++) {
	    off+=this.dist[i]*2;
	}
	
	var n = new C.Note({note: this.options.root,octaveOffset: oo});
	return n.offset(off);
    }
});



</pre>
</body>
</html>
